# Sony Spresenseç”»åƒã‚’ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ã«å¤‰æ›ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰

## ã¯ã˜ã‚ã«

Sony Spresenseã§æ’®å½±ã—ãŸç”»åƒã‚’Gemini 2.0 Flash AIã‚’ä½¿ã£ã¦ã‚¢ãƒ¡ãƒªã‚«ãƒ³ã‚³ãƒŸãƒƒã‚¯é¢¨ã«å¤‰æ›ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€**è©³ç´°ãª6è¦ç´ ã‚¢ãƒ¡ã‚³ãƒŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨Gemini 2.0 Flash APIã‚’æ´»ç”¨ã—ãŸé«˜å“è³ªå¤‰æ›**ã‚’å®Ÿç¾ã™ã‚‹å®Œå…¨ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

**ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚ï¼š**
- Spresenseã§æ’®å½±ã—ãŸç”»åƒã‚’ã‚¢ãƒ¼ãƒˆé¢¨ã«å¤‰æ›ã—ãŸã„
- AIç”»åƒç·¨é›†ãƒ»ç”ŸæˆæŠ€è¡“ã‚’å­¦ã³ãŸã„
- Gemini 2.0 Flash ã®ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ãŸã„
- ã‚¢ãƒ¡ãƒªã‚«ãƒ³ã‚³ãƒŸãƒƒã‚¯é¢¨ã®è¡¨ç¾æŠ€æ³•ã«èˆˆå‘³ãŒã‚ã‚‹

## TL;DRï¼ˆçµè«–ï¼‰

**ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ**: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« â†’ Pythonå‡¦ç† â†’ Gemini 2.0 Flash API â†’ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ç”»åƒ  
**å¤‰æ›æ–¹æ³•**: 6è¦ç´ è©³ç´°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ + Gemini 2.0 Flash ç”»åƒç·¨é›†æ©Ÿèƒ½  
**åˆ¶å¾¡**: ã‚·ãƒ³ãƒ—ãƒ«é–¢æ•°1ã¤ã§å®Œçµ

```python
# Pythonå´ã§ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›
from simple_image_editor import convert_to_comic_style

result = convert_to_comic_style("my_photo.jpg")
```

## ç’°å¢ƒãƒ»ä½¿ç”¨ã‚µãƒ¼ãƒ“ã‚¹

```
ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã€‘
- Sony Spresense ãƒ¡ã‚¤ãƒ³ãƒœãƒ¼ãƒ‰ + Camera Board
- æ’®å½±æ¸ˆã¿ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJPEG, PNGå¯¾å¿œï¼‰

ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã€‘
- Google Gemini 2.0 Flash API (ç”»åƒç”Ÿæˆãƒ»ç·¨é›†å¯¾å¿œ)

ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€‘
- Python 3.x
- å¿…è¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒª: google-genai, python-dotenv, Pillow

ã€é–‹ç™ºç’°å¢ƒã€‘
- macOS/Windows/Linux
- .env ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ç’°å¢ƒå¤‰æ•°ç®¡ç†
```

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ğŸ”„ å‹•ä½œãƒ•ãƒ­ãƒ¼

1. **ç”»åƒæº–å‚™**: å¤‰æ›ã—ãŸã„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
2. **AIå¤‰æ›**: Gemini 2.0 Flash APIã§6è¦ç´ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé©ç”¨
3. **ç”»åƒç”Ÿæˆ**: é«˜å“è³ªã‚¢ãƒ¡ã‚³ãƒŸé¢¨ç”»åƒã®ç”Ÿæˆãƒ»ä¿å­˜
4. **çµæœç¢ºèª**: å¤‰æ›çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®è¿”å´

### ğŸ¨ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ã®6è¦ç´ 

```
1. BOLD OUTLINES (å¤ªã„è¼ªéƒ­ç·š)
   - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤ªã„é»’ã„è¼ªéƒ­ç·šã‚’è¿½åŠ 

2. VIBRANT COLORS (é®®ã‚„ã‹ãªè‰²å½©)
   - é«˜å½©åº¦ã®åŸè‰²ã¨å¼·ã„ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’ä½¿ç”¨

3. ACTION LINES (åŠ¹æœç·š)
   - å‹•ãã‚„æ„Ÿæƒ…ã‚’è¡¨ç¾ã™ã‚‹é›†ä¸­ç·šãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰ç·šã‚’è¿½åŠ 

4. ONOMATOPOEIA (ã‚ªãƒãƒãƒˆãƒš)
   - "POW!", "CHOMP!", "SLURP!" ãªã©ã®åŠ¹æœéŸ³æ–‡å­—

5. HALFTONE EXPRESSION (ãƒãƒ¼ãƒ•ãƒˆãƒ¼ãƒ³)
   - èƒŒæ™¯ã‚„å½±ã«å°ã•ãªãƒ‰ãƒƒãƒˆæ¨¡æ§˜ã‚’é©ç”¨

6. EXAGGERATED EMOTIONS (èª‡å¼µè¡¨ç¾)
   - è¡¨æƒ…ã‚’å¤§ã’ã•ã«è¡¨ç¾ã€æ„Ÿæƒ…ã‚’å¼·èª¿
```

### ğŸ“¡ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
Python Script
    â†“
[1] convert_to_comic_style()
    â†“ 
Gemini 2.0 Flash API (ç”»åƒç·¨é›†)
    â†“
ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ç”»åƒ (PNGä¿å­˜)
    â†“
å¤‰æ›çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¿”å´
```

## Pythonå®Ÿè£… (å®Œå…¨ç‰ˆ)

### ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«: `simple_image_editor.py`

```python
import os
from google import genai
from google.genai import types
from PIL import Image
from dotenv import load_dotenv
import time
from io import BytesIO
import base64
import sys

# ç’°å¢ƒå¤‰æ•°ã‚’ãƒ­ãƒ¼ãƒ‰
load_dotenv()

class ImageEditor:
    """
    Gemini 2.0 Flash ã‚’ä½¿ç”¨ã—ãŸã‚¢ãƒ¡ã‚³ãƒŸé¢¨ç”»åƒå¤‰æ›ã‚¯ãƒ©ã‚¹
    """
    
    def __init__(self, model_name='gemini-2.0-flash-exp', output_dir="edited_images"):
        """
        åˆæœŸåŒ–
        
        Args:
            model_name (str): ä½¿ç”¨ã™ã‚‹Geminiãƒ¢ãƒ‡ãƒ«å
            output_dir (str): å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        """
        self.model_name = model_name
        self.output_dir = output_dir
        self.client = None
        self._setup_gemini()
    
    def _setup_gemini(self):
        """Gemini APIã‚’åˆæœŸåŒ–ã™ã‚‹"""
        api_key = os.getenv("GEMINI_API_KEY")
        if not api_key:
            raise ValueError("ç’°å¢ƒå¤‰æ•° 'GEMINI_API_KEY' ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
        
        try:
            self.client = genai.Client(api_key=api_key)
            print(f"âœ… Gemini API åˆæœŸåŒ–å®Œäº†: {self.model_name}")
        except Exception as e:
            raise Exception(f"Gemini APIåˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")
    
    @staticmethod
    def get_comic_style_prompt():
        """
        ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ç”¨ã®è©³ç´°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿”ã™
        
        Returns:
            str: ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        """
        return """Transform this image into American comic book style with the following specific elements:

1. BOLD OUTLINES: Add thick, strong black outlines around all characters and objects to create the distinctive comic book look with visual impact and character presence.

2. VIBRANT COLORS AND HIGH CONTRAST: Use bright, primary colors with high saturation and strong light-dark contrast. Adjust the photo's color tone to be brighter and more vivid. Express shadows clearly to emphasize three-dimensional effect.

3. ACTION LINES AND SPEED LINES: Add concentration lines and speed lines in the background to express movement, emotion, and impact. This creates dynamism and energy throughout the entire image.

4. ONOMATOPOEIA (SOUND EFFECTS): Place bold sound effect text like "POW!", "CHOMP!", "SLURP!", "ZZZ!" strategically. These visual sound effects should reinforce the visual information and instantly convey situations and emotions to viewers. Design the text in hand-drawn style with bold fonts following classic comic book typography.

5. HALFTONE (DOT) EXPRESSION: Apply small dot (halftone) textures to backgrounds and shadow areas, which is a classic comic book expression born from printing technology constraints. This creates a retro comic book atmosphere.

6. EXAGGERATED EMOTIONS: Make facial expressions more pronounced and expressive, incorporating the emotional exaggeration characteristic of comic book characters. Enlarge smiles and make expressions more dramatic.

Combine these elements to not just process the photo, but to recreate the visual language and expression style specific to the American comic book genre."""
    
    def edit_image(self, image_path, edit_prompt, output_filename=None):
        """
        æŒ‡å®šã•ã‚ŒãŸç”»åƒã‚’ç·¨é›†ã™ã‚‹
        
        Args:
            image_path (str): ç·¨é›†ã™ã‚‹ç”»åƒã®ãƒ‘ã‚¹
            edit_prompt (str): ç·¨é›†å†…å®¹ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            output_filename (str): ä¿å­˜ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆçœç•¥æ™‚ã¯è‡ªå‹•ç”Ÿæˆï¼‰
        
        Returns:
            str: ç·¨é›†ã•ã‚ŒãŸç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆå¤±æ•—æ™‚ã¯Noneï¼‰
        """
        
        # ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
        if not os.path.exists(image_path):
            print(f"âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {image_path}")
            return None
        
        if not self.client:
            print("âŒ Gemini APIãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“")
            return None
        
        # ç”»åƒã‚’èª­ã¿è¾¼ã¿
        try:
            with open(image_path, 'rb') as f:
                image_data = f.read()
            
            encoded_image = base64.b64encode(image_data).decode('utf-8')
            
            # MIMEã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
            if image_path.lower().endswith('.png'):
                mime_type = 'image/png'
            elif image_path.lower().endswith(('.jpg', '.jpeg')):
                mime_type = 'image/jpeg'
            elif image_path.lower().endswith('.gif'):
                mime_type = 'image/gif'
            elif image_path.lower().endswith('.webp'):
                mime_type = 'image/webp'
            else:
                mime_type = 'image/jpeg'  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            
            print(f"ğŸ“· ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†: {os.path.basename(image_path)}")
            print(f"ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: {len(image_data):,} bytes")
            
        except Exception as e:
            print(f"âŒ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {e}")
            return None
        
        # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
        os.makedirs(self.output_dir, exist_ok=True)
        
        # å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
        if not output_filename:
            base_name = os.path.splitext(os.path.basename(image_path))[0]
            timestamp = int(time.time())
            output_filename = f"comic_{base_name}_{timestamp}.png"
        
        output_path = os.path.join(self.output_dir, output_filename)
        
        try:
            print(f"ğŸ¨ ç”»åƒç·¨é›†ä¸­...")
            print("â³ Gemini APIã«é€ä¿¡ä¸­...")
            
            # ç”»åƒç·¨é›†ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            response = self.client.models.generate_content(
                model=self.model_name,
                contents=[
                    {
                        "role": "user",
                        "parts": [
                            {
                                "text": f"Edit this image: {edit_prompt}"
                            },
                            {
                                "inline_data": {
                                    "mime_type": mime_type,
                                    "data": encoded_image
                                }
                            }
                        ]
                    }
                ],
                config=types.GenerateContentConfig(
                    response_modalities=["Text", "Image"],
                    temperature=0.7,
                    max_output_tokens=2048
                )
            )
            
            print("âœ¨ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡å®Œäº†")
            
            # ç·¨é›†ã•ã‚ŒãŸç”»åƒã‚’å‡¦ç†
            image_saved = False
            
            for part in response.parts:
                if hasattr(part, 'inline_data') and part.inline_data:
                    try:
                        new_image_data = part.inline_data.data
                        
                        if isinstance(new_image_data, str):
                            new_image_data = base64.b64decode(new_image_data)
                        
                        # PILã§ç”»åƒã‚’ä¿å­˜
                        image = Image.open(BytesIO(new_image_data))
                        image.save(output_path)
                        
                        print(f"ğŸ’¾ ç·¨é›†ç”»åƒä¿å­˜å®Œäº†: {output_path}")
                        image_saved = True
                        
                    except Exception as img_error:
                        print(f"âš ï¸ ç”»åƒä¿å­˜ã‚¨ãƒ©ãƒ¼: {img_error}")
            
            if image_saved:
                return output_path
            else:
                print("âš ï¸ ç·¨é›†ç”»åƒãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ")
                return None
            
        except Exception as e:
            print(f"âŒ ç”»åƒç·¨é›†ã‚¨ãƒ©ãƒ¼: {e}")
            return None

def convert_to_comic_style(image_path):
    """
    æŒ‡å®šã•ã‚ŒãŸç”»åƒã‚’ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ã«å¤‰æ›ã™ã‚‹
    
    Args:
        image_path (str): å¤‰æ›ã™ã‚‹ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    
    Returns:
        str: å¤‰æ›ã•ã‚ŒãŸç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆå¤±æ•—æ™‚ã¯Noneï¼‰
    """
    # ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
    if not os.path.exists(image_path):
        print(f"âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {image_path}")
        return None
    
    # ImageEditorã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
    try:
        editor = ImageEditor()
    except Exception as e:
        print(f"âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: {e}")
        return None
    
    # ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾—
    comic_prompt = ImageEditor.get_comic_style_prompt()
    
    print(f"ğŸ¦¸ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›é–‹å§‹: {os.path.basename(image_path)}")
    
    # ç”»åƒå¤‰æ›å®Ÿè¡Œ
    result = editor.edit_image(image_path, comic_prompt)
    
    if result:
        print(f"âœ… ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å®Œäº†: {result}")
        return result
    else:
        print("âŒ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ")
        return None

def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°"""
    print("ğŸ¦¸ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ç”»åƒå¤‰æ›ãƒ„ãƒ¼ãƒ«")
    print("ğŸ“± Gemini 2.0 Flash ã§ã‚¢ãƒ¡ãƒªã‚«ãƒ³ã‚³ãƒŸãƒƒã‚¯é¢¨ã«å¤‰æ›")
    print("=" * 50)
    
    # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’ãƒã‚§ãƒƒã‚¯
    if len(sys.argv) == 2:
        image_path = sys.argv[1]
        result = convert_to_comic_style(image_path)
        
        if result:
            print(f"\nğŸ‰ å¤‰æ›å®Œäº†: {result}")
        else:
            print("\nğŸ’¥ å¤‰æ›å¤±æ•—")
        return
    
    # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰
    try:
        while True:
            print("\n" + "=" * 50)
            print("ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ã‚’é–‹å§‹ã—ã¾ã™")
            print("çµ‚äº†ã™ã‚‹ã«ã¯ 'quit' ã¨å…¥åŠ›ã—ã¦ãã ã•ã„")
            print("=" * 50)
            
            # ç”»åƒãƒ‘ã‚¹å…¥åŠ›
            image_path = input("ğŸ–¼ï¸ å¤‰æ›ã™ã‚‹ç”»åƒã®ãƒ‘ã‚¹: ").strip()
            
            if image_path.lower() in ['quit', 'exit', 'çµ‚äº†']:
                print("ğŸ‘‹ å¤‰æ›ã‚’çµ‚äº†ã—ã¾ã™")
                break
            
            if not image_path:
                print("âŒ ç”»åƒãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
                continue
            
            # ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å®Ÿè¡Œ
            result = convert_to_comic_style(image_path)
            
            if result:
                print(f"\nğŸ‰ å¤‰æ›å®Œäº†: {result}")
                
                # ç¶šè¡Œç¢ºèª
                continue_convert = input("\nä»–ã®ç”»åƒã‚‚å¤‰æ›ã—ã¾ã™ã‹ï¼Ÿ (y/n): ").strip().lower()
                if continue_convert not in ['y', 'yes', 'ã¯ã„']:
                    print("ğŸ‘‹ å¤‰æ›ã‚’çµ‚äº†ã—ã¾ã™")
                    break
            else:
                print("\nğŸ’¥ å¤‰æ›å¤±æ•—")
                
                retry = input("åˆ¥ã®ç”»åƒã§å†è©¦è¡Œã—ã¾ã™ã‹ï¼Ÿ (y/n): ").strip().lower()
                if retry not in ['y', 'yes', 'ã¯ã„']:
                    print("ğŸ‘‹ å¤‰æ›ã‚’çµ‚äº†ã—ã¾ã™")
                    break
    
    except KeyboardInterrupt:
        print("\nğŸ‘‹ å¤‰æ›ã‚’çµ‚äº†ã—ã¾ã™")
    except Exception as e:
        print(f"\nâŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")

if __name__ == "__main__":
    main()
```

### ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: `.env`

```bash
# Gemini API è¨­å®š
GEMINI_API_KEY=your_gemini_api_key_here
```

### ä¾å­˜é–¢ä¿‚ãƒ•ã‚¡ã‚¤ãƒ«: `requirements-dev.txt`

```
google-genai
python-dotenv
google-generativeai
pyserial
Pillow
line-bot-sdk
requests
supabase
```

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Step 1: Gemini API ã®å–å¾—

1. **Google AI Studio ã«ã‚¢ã‚¯ã‚»ã‚¹**
   - https://aistudio.google.com/
   
2. **APIã‚­ãƒ¼ã‚’å–å¾—**
   - ã€ŒGet API keyã€ã‹ã‚‰æ–°ã—ã„APIã‚­ãƒ¼ã‚’ä½œæˆ
   
3. **ç’°å¢ƒå¤‰æ•°ã«è¨­å®š**
   ```bash
   # .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
   GEMINI_API_KEY=your_actual_api_key_here
   ```

### Step 2: Pythonç’°å¢ƒã®æº–å‚™

1. **ä»®æƒ³ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate  # macOS/Linux
   # .venv\Scripts\activate   # Windows
   ```

2. **ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   pip install -r requirements-dev.txt
   ```

3. **ç’°å¢ƒå¤‰æ•°è¨­å®š**
   - `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’è¨­å®š

### Step 3: å‹•ä½œãƒ†ã‚¹ãƒˆ

```bash
# CLIã§ç›´æ¥å®Ÿè¡Œ
python3 simple_image_editor.py your_photo.jpg

# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰
python3 simple_image_editor.py
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
```
ğŸ¦¸ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ç”»åƒå¤‰æ›ãƒ„ãƒ¼ãƒ«
ğŸ“± Gemini 2.0 Flash ã§ã‚¢ãƒ¡ãƒªã‚«ãƒ³ã‚³ãƒŸãƒƒã‚¯é¢¨ã«å¤‰æ›
==================================================
âœ… Gemini API åˆæœŸåŒ–å®Œäº†: gemini-2.0-flash-exp
ğŸ¦¸ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›é–‹å§‹: my_photo.jpg
ğŸ“· ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†: my_photo.jpg
ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 234,567 bytes
ğŸ¨ ç”»åƒç·¨é›†ä¸­...
â³ Gemini APIã«é€ä¿¡ä¸­...
âœ¨ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡å®Œäº†
ğŸ’¾ ç·¨é›†ç”»åƒä¿å­˜å®Œäº†: edited_images/comic_my_photo_1760123456.png
âœ… ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å®Œäº†: edited_images/comic_my_photo_1760123456.png

ğŸ‰ å¤‰æ›å®Œäº†: edited_images/comic_my_photo_1760123456.png
```

## ğŸ¯ å®Ÿè£…ä¸Šã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

### 1. ã‚·ãƒ³ãƒ—ãƒ«é–¢æ•°è¨­è¨ˆ

**âœ… åˆ©ç‚¹:**
```python
# [1] ãƒ¡ã‚¤ãƒ³å¤‰æ›é–¢æ•°ï¼ˆä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ï¼‰
convert_to_comic_style(image_path)

# [2] ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®å†…éƒ¨å®Ÿè£…
ImageEditor.edit_image(image_path, comic_prompt)

# [3] é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾—
ImageEditor.get_comic_style_prompt()
```

### 2. 6è¦ç´ è©³ç´°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```python
# ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ã®æ ¸ã¨ãªã‚‹è¦ç´ 
comic_prompt = """
1. BOLD OUTLINES: å¤ªã„é»’ã„è¼ªéƒ­ç·š
2. VIBRANT COLORS: é®®ã‚„ã‹ãªè‰²å½©ã¨å¼·ã„ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ  
3. ACTION LINES: é›†ä¸­ç·šãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰ç·š
4. ONOMATOPOEIA: POW!,CHOMP!ãªã©ã®åŠ¹æœéŸ³
5. HALFTONE EXPRESSION: ãƒ‰ãƒƒãƒˆæ¨¡æ§˜ãƒ†ã‚¯ã‚¹ãƒãƒ£
6. EXAGGERATED EMOTIONS: èª‡å¼µã•ã‚ŒãŸè¡¨æƒ…
"""
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨å‡ºåŠ›ç®¡ç†

```python
# ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
if not os.path.exists(image_path):
    print(f"âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {image_path}")
    return None

# å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã®è‡ªå‹•ç”Ÿæˆ
output_filename = f"comic_{base_name}_{timestamp}.png"

# APIå¿œç­”ã®ç”»åƒãƒ‡ãƒ¼ã‚¿å‡¦ç†
for part in response.parts:
    if hasattr(part, 'inline_data') and part.inline_data:
        # Base64ãƒ‡ã‚³ãƒ¼ãƒ‰â†’PILâ†’PNGä¿å­˜
        image_data = base64.b64decode(part.inline_data.data)
        image = Image.open(BytesIO(image_data))
        image.save(output_path)
```

## ğŸ”§ ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®å‘¼ã³å‡ºã—æ–¹æ³•

### ã‚«ãƒ¡ãƒ©ã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã®é€£æº

```python
# capture_and_convert.py
from simple_image_editor import convert_to_comic_style

def capture_and_convert():
    """æ’®å½±å¾Œã«ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›"""
    # Spresenseã§æ’®å½±å®Ÿè¡Œ
    latest_image = capture_latest_image()  # æ’®å½±é–¢æ•°
    
    if latest_image:
        # ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›
        comic_result = convert_to_comic_style(latest_image)
        
        if comic_result:
            print(f"ğŸ¦¸ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å®Œäº†: {comic_result}")
            return comic_result
        else:
            print("âŒ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å¤±æ•—")
            return None
```

### ä¸€æ‹¬å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```python
# batch_converter.py
import glob
from simple_image_editor import convert_to_comic_style

def batch_convert_images(image_directory):
    """æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®å…¨ç”»åƒã‚’ä¸€æ‹¬å¤‰æ›"""
    image_files = glob.glob(f"{image_directory}/*.jpg") + glob.glob(f"{image_directory}/*.png")
    
    results = []
    for image_file in image_files:
        print(f"ğŸ”„ å¤‰æ›ä¸­: {image_file}")
        result = convert_to_comic_style(image_file)
        
        if result:
            results.append(result)
            print(f"âœ… å®Œäº†: {result}")
        else:
            print(f"âŒ å¤±æ•—: {image_file}")
    
    print(f"\nğŸ‰ ä¸€æ‹¬å¤‰æ›å®Œäº†: {len(results)}ä»¶æˆåŠŸ")
    return results

# ä½¿ç”¨ä¾‹
batch_convert_images("captured_images")
```

### LINE Boté€£æº

```python
# comic_line_bot.py
from simple_image_editor import convert_to_comic_style
from line_bot_push import send_image_with_line_push

def convert_and_notify(original_image):
    """ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›ã—ã¦LINEé€šçŸ¥"""
    # ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›
    comic_image = convert_to_comic_style(original_image)
    
    if comic_image:
        # LINE Botã§é€ä¿¡ï¼ˆã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ»ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ã®ä¸¡æ–¹ï¼‰
        success = send_image_with_line_push(
            original_path=original_image,     # ã‚ªãƒªã‚¸ãƒŠãƒ«ç”»åƒ
            preview_path=comic_image         # ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«
        )
        
        if success:
            print("ğŸ“± ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ç”»åƒã‚’LINEé€ä¿¡å®Œäº†")
        else:
            print("âŒ LINEé€ä¿¡å¤±æ•—")
    else:
        print("âŒ ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å¤±æ•—")
```

## ğŸŒŸ å¿œç”¨ãƒ»æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

### 1. è¤‡æ•°ã‚¹ã‚¿ã‚¤ãƒ«å¯¾å¿œ

```python
def convert_to_multiple_styles(image_path):
    """è¤‡æ•°ã®ã‚¢ãƒ¼ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã§å¤‰æ›"""
    styles = {
        "comic": ImageEditor.get_comic_style_prompt(),
        "anime": "Convert to anime/manga style with clean lines",
        "watercolor": "Transform into watercolor painting style"
    }
    
    results = {}
    for style_name, prompt in styles.items():
        editor = ImageEditor()
        result = editor.edit_image(image_path, prompt)
        if result:
            results[style_name] = result
    
    return results
```

### 2. å“è³ªè¨­å®šå¯¾å¿œ

```python
def convert_with_quality_settings(image_path, quality="high"):
    """å“è³ªè¨­å®šä»˜ãå¤‰æ›"""
    quality_settings = {
        "high": {"temperature": 0.3, "max_tokens": 4096},
        "medium": {"temperature": 0.7, "max_tokens": 2048}, 
        "fast": {"temperature": 1.0, "max_tokens": 1024}
    }
    
    settings = quality_settings.get(quality, quality_settings["medium"])
    
    editor = ImageEditor()
    # ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã§å¤‰æ›å®Ÿè¡Œ
    return editor.edit_image_with_settings(image_path, settings)
```

### 3. é€²æ—è¡¨ç¤ºæ©Ÿèƒ½

```python
def convert_with_progress(image_path):
    """é€²æ—è¡¨ç¤ºä»˜ãå¤‰æ›"""
    import time
    
    print("ğŸ”„ [1/4] ç”»åƒèª­ã¿è¾¼ã¿ä¸­...")
    time.sleep(0.5)
    
    print("ğŸ”„ [2/4] Gemini APIæ¥ç¶šä¸­...")
    editor = ImageEditor()
    time.sleep(0.5)
    
    print("ğŸ”„ [3/4] ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›å‡¦ç†ä¸­...")
    result = convert_to_comic_style(image_path)
    
    print("ğŸ”„ [4/4] çµæœä¿å­˜ä¸­...")
    time.sleep(0.5)
    
    print("âœ… å¤‰æ›å®Œäº†!")
    return result
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

| ç—‡çŠ¶ | åŸå›  | è§£æ±ºæ–¹æ³• |
|------|------|----------|
| `âŒ ValueError: ç’°å¢ƒå¤‰æ•° 'GEMINI_API_KEY' ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“` | API Keyæœªè¨­å®š | `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«æ­£ã—ã„APIã‚­ãƒ¼ã‚’è¨­å®š |
| `âŒ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“` | ç”»åƒãƒ‘ã‚¹é–“é•ã„ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèªã€ç›¸å¯¾ãƒ‘ã‚¹ãƒ»çµ¶å¯¾ãƒ‘ã‚¹æ³¨æ„ |
| `âš ï¸ ç·¨é›†ç”»åƒãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ` | APIå¿œç­”ã‚¨ãƒ©ãƒ¼ | APIã‚­ãƒ¼ç¢ºèªã€ç”»åƒã‚µã‚¤ã‚ºãƒ»å½¢å¼ç¢ºèª |
| å¤‰æ›ã«æ™‚é–“ãŒã‹ã‹ã‚‹ | å¤§ãã„ç”»åƒã‚µã‚¤ã‚º | ç”»åƒã‚µã‚¤ã‚ºã‚’äº‹å‰ã«ãƒªã‚µã‚¤ã‚º |

### ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒãƒ³ãƒ‰

```python
# ç’°å¢ƒç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
def check_environment():
    """ç’°å¢ƒè¨­å®šç¢ºèª"""
    import os
    from dotenv import load_dotenv
    
    load_dotenv()
    
    # API Keyç¢ºèª
    api_key = os.getenv("GEMINI_API_KEY")
    print(f"GEMINI_API_KEY: {'âœ… è¨­å®šæ¸ˆã¿' if api_key else 'âŒ æœªè¨­å®š'}")
    
    # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª
    try:
        from google import genai
        print("google-genai: âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿")
    except ImportError:
        print("google-genai: âŒ æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«")
    
    try:
        from PIL import Image
        print("Pillow: âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿")
    except ImportError:
        print("Pillow: âŒ æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«")

# ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ
def check_image_file(image_path):
    """ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª"""
    import os
    from PIL import Image
    
    if os.path.exists(image_path):
        print(f"âœ… ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨: {image_path}")
        
        try:
            with Image.open(image_path) as img:
                print(f"ğŸ“Š ç”»åƒæƒ…å ±: {img.format} {img.size} {img.mode}")
        except Exception as e:
            print(f"âŒ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {e}")
    else:
        print(f"âŒ ãƒ•ã‚¡ã‚¤ãƒ«æœªç™ºè¦‹: {image_path}")

# ä½¿ç”¨ä¾‹
check_environment()
check_image_file("my_photo.jpg")
```

## ğŸ“š å‚è€ƒè³‡æ–™ãƒ»é–¢é€£ãƒªãƒ³ã‚¯

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- ğŸ“– [Google AI Studio](https://aistudio.google.com/)
- ğŸ”§ [Gemini API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://ai.google.dev/)
- ğŸ [Google GenAI Python SDK](https://github.com/google/generative-ai-python)

### é–¢é€£æŠ€è¡“
- ğŸ¨ [PIL/Pillow ç”»åƒå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª](https://pillow.readthedocs.io/)
- ğŸ“ [Python dotenv](https://github.com/theskumar/python-dotenv)

### ã‚¢ãƒ¡ã‚³ãƒŸé¢¨è¡¨ç¾æŠ€æ³•
- ğŸ¦¸ [American Comic Book Art Techniques](https://en.wikipedia.org/wiki/American_comic_book)
- ğŸ­ [Halftone in Comic Books](https://en.wikipedia.org/wiki/Halftone)

## ğŸª å®Ÿéš›ã®æ´»ç”¨ä¾‹

**ã“ã®ã‚·ã‚¹ãƒ†ãƒ ãŒæ´»ã‹ã›ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼š**
- ğŸ“· **SNSæŠ•ç¨¿ç”¨ã‚¢ãƒ¼ãƒˆåŠ å·¥** - æ™®é€šã®å†™çœŸã‚’ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒ†ã‚£ãƒƒã‚¯ã«å¤‰æ›
- ğŸ® **ã‚²ãƒ¼ãƒ é–‹ç™ºç´ æä½œæˆ** - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã®ã‚³ãƒŸãƒƒã‚¯é¢¨å¤‰æ›
- ğŸ“š **æ•™è‚²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ¶ä½œ** - èª¬æ˜å›³ã‚’ã‚ˆã‚Šè¦ªã—ã¿ã‚„ã™ãå¤‰æ›
- ğŸ¨ **ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ãƒˆåˆ¶ä½œ** - AIæ”¯æ´ã«ã‚ˆã‚‹ã‚¢ãƒ¼ãƒˆä½œå“åˆ¶ä½œ
- ğŸ“± **IoTç”»åƒå‡¦ç†** - Spresenseæ’®å½±ç”»åƒã®è‡ªå‹•ã‚¢ãƒ¼ãƒˆåŒ–

## ğŸ·ï¸ ã‚¿ã‚°
`#Gemini 2.0` `#AIç”»åƒç”Ÿæˆ` `#ã‚¢ãƒ¡ã‚³ãƒŸé¢¨å¤‰æ›` `#Python` `#ç”»åƒå‡¦ç†` `#Sony Spresense` `#ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ãƒ“ã‚¸ãƒ§ãƒ³` `#ã‚¢ãƒ¼ãƒˆç”Ÿæˆ` `#APIé€£æº`

---

ã“ã®è¨˜äº‹ãŒã€Sony Spresenseç”»åƒã‚’AIã§ã‚¢ãƒ¡ã‚³ãƒŸé¢¨ã«å¤‰æ›ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ï¼è³ªå•ã‚„ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Œã°ã€ãŠæ°—è»½ã«ãŠå¯„ã›ãã ã•ã„ã€‚

**ğŸ”„ æ›´æ–°å±¥æ­´**
- 2024/10/12: åˆå›å…¬é–‹
- 2024/10/12: ã‚·ãƒ³ãƒ—ãƒ«é–¢æ•°è¨­è¨ˆã¨6è¦ç´ è©³ç´°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å®Ÿè£…
- 2024/10/12: ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®å‘¼ã³å‡ºã—ä¾‹ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¿½åŠ 