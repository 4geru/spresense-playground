{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/4geru/space/spresense/spresense-slideshow/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport Image from 'next/image';\nimport Link from 'next/link';\n\ninterface ImageData {\n  name: string;\n  url: string;\n  created_at: string;\n  size: number;\n}\n\nexport default function SlideshowPage() {\n  const [images, setImages] = useState<ImageData[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [lastImageCount, setLastImageCount] = useState(0);\n  const [currentTime, setCurrentTime] = useState('');\n\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  // ÁîªÂÉè„ÇíË™≠„ÅøËæº„ÇÄ\n  const loadImages = useCallback(async () => {\n    try {\n      if (!supabaseUrl || !supabaseKey) {\n        throw new Error('Supabase configuration missing');\n      }\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/get-original-images`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${supabaseKey}`,\n          'apikey': supabaseKey,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);\n      }\n\n      const result = await response.json();\n\n      if (result.success && result.images) {\n        const imageList = result.images.map((image: any) => ({\n          name: image.name,\n          url: image.url,\n          created_at: image.created_at,\n          size: image.size\n        }));\n\n        setImages(imageList);\n        setLastImageCount(imageList.length);\n\n        if (imageList.length > 0) {\n          setCurrentIndex(Math.floor(Math.random() * imageList.length));\n          setLoading(false);\n        } else {\n          throw new Error('No images found with \"original_capture\" in filename');\n        }\n      } else {\n        throw new Error(result.error || 'No images returned from Edge Function');\n      }\n    } catch (err) {\n      console.error('Error loading images:', err);\n      setError(err instanceof Error ? err.message : 'Failed to load images');\n      setLoading(false);\n    }\n  }, [supabaseUrl, supabaseKey]);\n\n  // Êñ∞„Åó„ÅÑÁîªÂÉè„Çí„ÉÅ„Çß„ÉÉ„ÇØ\n  const checkForNewImages = useCallback(async () => {\n    try {\n      if (!supabaseUrl || !supabaseKey) return;\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/get-original-images`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${supabaseKey}`,\n          'apikey': supabaseKey,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (!response.ok) return;\n\n      const result = await response.json();\n\n      if (result.success && result.images) {\n        const newImageCount = result.images.length;\n\n        if (newImageCount > lastImageCount) {\n          console.log(`üÜï New images detected! ${lastImageCount} ‚Üí ${newImageCount}`);\n\n          const imageList = result.images.map((image: any) => ({\n            name: image.name,\n            url: image.url,\n            created_at: image.created_at,\n            size: image.size\n          }));\n\n          setImages(imageList);\n          setLastImageCount(newImageCount);\n          setCurrentIndex(Math.floor(Math.random() * imageList.length));\n\n          setNotification(`üÜï ${newImageCount - lastImageCount} new image${newImageCount - lastImageCount > 1 ? 's' : ''} detected!`);\n          setTimeout(() => setNotification(null), 3000);\n        }\n      }\n    } catch (err) {\n      console.error('Error checking for new images:', err);\n    }\n  }, [supabaseUrl, supabaseKey, lastImageCount]);\n\n  // Ê¨°„ÅÆÁîªÂÉè„Å´ÁßªÂãï\n  const nextImage = useCallback(() => {\n    if (images.length === 0) return;\n\n    let nextIndex;\n    if (images.length > 1) {\n      do {\n        nextIndex = Math.floor(Math.random() * images.length);\n      } while (nextIndex === currentIndex);\n    } else {\n      nextIndex = 0;\n    }\n\n    setCurrentIndex(nextIndex);\n  }, [images.length, currentIndex]);\n\n  // ÂàùÊúüË™≠„ÅøËæº„Åø\n  useEffect(() => {\n    loadImages();\n  }, [loadImages]);\n\n  // „Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº\n  useEffect(() => {\n    if (images.length <= 1) return;\n\n    const getRandomInterval = () => Math.floor(Math.random() * 1000) + 2000; // 2-3Áßí\n\n    const scheduleNext = () => {\n      const interval = getRandomInterval();\n      const timer = setTimeout(() => {\n        nextImage();\n      }, interval);\n      return timer;\n    };\n\n    const timer = scheduleNext();\n    return () => clearTimeout(timer);\n  }, [images.length, nextImage, currentIndex]);\n\n  // Ëá™Âãï„É™„Éï„É¨„ÉÉ„Ç∑„É•Ôºà30Áßí„Åî„Å®Ôºâ\n  useEffect(() => {\n    const interval = setInterval(() => {\n      checkForNewImages();\n    }, 30000);\n\n    return () => clearInterval(interval);\n  }, [checkForNewImages]);\n\n  // ÊôÇÂàªÊõ¥Êñ∞\n  useEffect(() => {\n    const updateTime = () => {\n      setCurrentTime(new Date().toLocaleTimeString());\n    };\n\n    updateTime();\n    const interval = setInterval(updateTime, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-black\">\n        <div className=\"text-white text-2xl\">Loading images...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-black\">\n        <div className=\"text-red-400 text-xl text-center\">\n          <p>Failed to load images from Supabase</p>\n          <p className=\"mt-2\">Please check your connection and configuration</p>\n          <p className=\"mt-4 text-sm\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative w-screen h-screen bg-black overflow-hidden\">\n      {/* ÈÄöÁü• */}\n      {notification && (\n        <div className=\"fixed top-5 right-5 bg-green-500 bg-opacity-90 text-white px-5 py-4 rounded-lg text-base z-[2000] shadow-lg animate-slide-in\">\n          {notification}\n        </div>\n      )}\n\n      {/* „Çπ„ÉÜ„Éº„Çø„Çπ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */}\n      <div className=\"fixed top-5 left-5 bg-black bg-opacity-70 text-white px-4 py-2 rounded-md text-sm z-[2000]\">\n        üì∏ Images: {images.length} | üïí {currentTime}\n      </div>\n\n      {/* ÁîªÂÉè‰∏ÄË¶ß„Å∏„ÅÆ„É™„É≥„ÇØ */}\n      <Link\n        href=\"/slides\"\n        className=\"fixed top-5 left-1/2 -translate-x-1/2 bg-purple-600 bg-opacity-90 hover:bg-opacity-100 text-white px-6 py-2 rounded-lg text-sm z-[2000] transition shadow-lg\"\n      >\n        üì∑ View Gallery\n      </Link>\n\n      {/* „Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº */}\n      {images.length > 0 && (\n        <div className=\"w-full h-full flex items-center justify-center\">\n          <div className=\"relative w-full h-full\">\n            <Image\n              src={images[currentIndex].url}\n              alt={images[currentIndex].name}\n              fill\n              className=\"object-contain\"\n              priority\n              unoptimized // Supabase„ÅÆÁîªÂÉè„Å™„ÅÆ„ÅßÊúÄÈÅ©Âåñ„Çí„Çπ„Ç≠„ÉÉ„Éó\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}