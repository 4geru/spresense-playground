{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/4geru/space/spresense/spresense-slideshow/lib/supabase.ts"],"sourcesContent":["import { ImageData } from './types';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n/**\n * Supabaseから全画像を取得\n */\nexport async function fetchImages(): Promise<ImageData[]> {\n  if (!supabaseUrl || !supabaseKey) {\n    throw new Error('Supabase configuration missing');\n  }\n\n  const response = await fetch(`${supabaseUrl}/functions/v1/get-original-images`, {\n    method: 'GET',\n    headers: {\n      'Authorization': `Bearer ${supabaseKey}`,\n      'apikey': supabaseKey,\n      'Content-Type': 'application/json'\n    },\n    cache: 'no-store', // 常に最新データを取得\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);\n  }\n\n  const result = await response.json();\n\n  if (result.success && result.images) {\n    return result.images.map((image: any) => ({\n      name: image.name,\n      url: image.url,\n      created_at: image.created_at,\n      size: image.size\n    }));\n  }\n\n  throw new Error(result.error || 'No images returned from Edge Function');\n}\n"],"names":[],"mappings":";;;;AAEoB;AAApB,MAAM;AACN,MAAM;AAKC,eAAe;IACpB;;IAIA,MAAM,WAAW,MAAM,MAAM,GAAG,YAAY,iCAAiC,CAAC,EAAE;QAC9E,QAAQ;QACR,SAAS;YACP,iBAAiB,CAAC,OAAO,EAAE,aAAa;YACxC,UAAU;YACV,gBAAgB;QAClB;QACA,OAAO;IACT;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,YAAY,MAAM,SAAS,IAAI;QACrC,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,CAAC,GAAG,EAAE,WAAW;IACzE;IAEA,MAAM,SAAS,MAAM,SAAS,IAAI;IAElC,IAAI,OAAO,OAAO,IAAI,OAAO,MAAM,EAAE;QACnC,OAAO,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC,QAAe,CAAC;gBACxC,MAAM,MAAM,IAAI;gBAChB,KAAK,MAAM,GAAG;gBACd,YAAY,MAAM,UAAU;gBAC5B,MAAM,MAAM,IAAI;YAClB,CAAC;IACH;IAEA,MAAM,IAAI,MAAM,OAAO,KAAK,IAAI;AAClC","debugId":null}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///Users/4geru/space/spresense/spresense-slideshow/lib/utils.ts"],"sourcesContent":["/**\n * ファイル名から安定したハッシュIDを生成\n * 同じファイル名なら常に同じハッシュIDが生成される\n */\nexport function generateHashId(fileName: string): string {\n  let hash = 0;\n  for (let i = 0; i < fileName.length; i++) {\n    const char = fileName.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n\n  // 絶対値を取って16進数に変換（9文字）\n  return Math.abs(hash).toString(16).padStart(9, '0').substring(0, 9);\n}\n\n/**\n * ハッシュIDから対応する画像を検索\n */\nexport function findImageByHashId(images: { name: string; [key: string]: any }[], hashId: string) {\n  return images.find(img => generateHashId(img.name) === hashId);\n}\n\n/**\n * Supabaseの画像URLをサムネイル用に変換\n * 画像変換APIを使用してサムネイルを取得\n */\nexport function getThumbnailUrl(originalUrl: string, width: number = 400, height: number = 400): string {\n  // まず元のURLをそのまま返す（画像変換APIが使えない場合）\n  // TODO: Supabase画像変換APIが有効な場合は以下のコードを使用\n  /*\n  const url = originalUrl.replace(\n    '/storage/v1/object/public/',\n    '/storage/v1/render/image/public/'\n  );\n  return `${url}?width=${width}&height=${height}&resize=cover&quality=80`;\n  */\n\n  // 一時的に元のURLを返す\n  return originalUrl;\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AACM,SAAS,eAAe,QAAgB;IAC7C,IAAI,OAAO;IACX,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,MAAM,EAAE,IAAK;QACxC,MAAM,OAAO,SAAS,UAAU,CAAC;QACjC,OAAO,AAAC,CAAC,QAAQ,CAAC,IAAI,OAAQ;QAC9B,OAAO,OAAO,MAAM,2BAA2B;IACjD;IAEA,sBAAsB;IACtB,OAAO,KAAK,GAAG,CAAC,MAAM,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG,KAAK,SAAS,CAAC,GAAG;AACnE;AAKO,SAAS,kBAAkB,MAA8C,EAAE,MAAc;IAC9F,OAAO,OAAO,IAAI,CAAC,CAAA,MAAO,eAAe,IAAI,IAAI,MAAM;AACzD;AAMO,SAAS,gBAAgB,WAAmB,EAAE,QAAgB,GAAG,EAAE,SAAiB,GAAG;IAC5F,iCAAiC;IACjC,wCAAwC;IACxC;;;;;;EAMA,GAEA,eAAe;IACf,OAAO;AACT","debugId":null}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/4geru/space/spresense/spresense-slideshow/app/slides/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { fetchImages } from '@/lib/supabase';\nimport { generateHashId, getThumbnailUrl } from '@/lib/utils';\nimport { ImageWithHash } from '@/lib/types';\n\n// スケルトンローダーコンポーネント\nfunction ImageSkeleton() {\n  return (\n    <div className=\"aspect-square bg-gray-900 rounded-lg overflow-hidden animate-pulse\">\n      <div className=\"w-full h-full bg-gray-800\"></div>\n    </div>\n  );\n}\n\nexport default function SlidesPage() {\n  const [images, setImages] = useState<ImageWithHash[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    async function loadImages() {\n      try {\n        const data = await fetchImages();\n        const imagesWithHash = data.map(img => ({\n          ...img,\n          hashId: generateHashId(img.name)\n        }));\n\n        // 新しい順にソート\n        imagesWithHash.sort((a, b) =>\n          new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n        );\n\n        // デバッグ: 最初の画像のURLを確認\n        if (imagesWithHash.length > 0) {\n          console.log('First image URL:', imagesWithHash[0].url);\n          console.log('Total images:', imagesWithHash.length);\n        }\n\n        setImages(imagesWithHash);\n        setLoading(false);\n      } catch (err) {\n        console.error('Error loading images:', err);\n        setError(err instanceof Error ? err.message : 'Failed to load images');\n        setLoading(false);\n      }\n    }\n\n    loadImages();\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-black text-white\">\n        <header className=\"sticky top-0 z-10 bg-black bg-opacity-90 backdrop-blur border-b border-gray-800\">\n          <div className=\"container mx-auto px-4 py-4 flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-2xl font-bold\">Gallery</h1>\n              <p className=\"text-sm text-gray-400\">Loading...</p>\n            </div>\n            <Link\n              href=\"/\"\n              className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition\"\n            >\n              Slideshow\n            </Link>\n          </div>\n        </header>\n        <main className=\"container mx-auto px-4 py-8\">\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n            {Array.from({ length: 10 }).map((_, i) => (\n              <ImageSkeleton key={i} />\n            ))}\n          </div>\n        </main>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-black\">\n        <div className=\"text-red-400 text-xl text-center\">\n          <p>Failed to load images</p>\n          <p className=\"mt-4 text-sm\">{error}</p>\n          <Link href=\"/\" className=\"mt-6 inline-block text-blue-400 hover:text-blue-300\">\n            ← Back to Home\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-black text-white\">\n      {/* ヘッダー */}\n      <header className=\"sticky top-0 z-10 bg-black bg-opacity-90 backdrop-blur border-b border-gray-800\">\n        <div className=\"container mx-auto px-4 py-4 flex justify-between items-center\">\n          <div>\n            <h1 className=\"text-2xl font-bold\">Gallery</h1>\n            <p className=\"text-sm text-gray-400\">{images.length} images</p>\n          </div>\n          <Link\n            href=\"/\"\n            className=\"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition\"\n          >\n            Slideshow\n          </Link>\n        </div>\n      </header>\n\n      {/* 画像グリッド */}\n      <main className=\"container mx-auto px-4 py-8\">\n        {images.length === 0 ? (\n          <div className=\"text-center text-gray-400 py-20\">\n            <p className=\"text-xl\">No images found</p>\n            <p className=\"mt-2\">Upload some images to get started</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4\">\n            {images.map((image, index) => {\n              // 最初の8枚は優先的にロード\n              const isPriority = index < 8;\n              // サムネイルURLを取得（400x400）\n              const thumbnailUrl = getThumbnailUrl(image.url, 400, 400);\n\n              return (\n                <Link\n                  key={image.hashId}\n                  href={`/slides/${image.hashId}`}\n                  className=\"group relative aspect-square bg-gray-900 rounded-lg overflow-hidden hover:ring-2 hover:ring-purple-500 transition\"\n                >\n                  <Image\n                    src={thumbnailUrl}\n                    alt={image.name}\n                    fill\n                    className=\"object-cover group-hover:scale-105 transition-transform duration-300\"\n                    sizes=\"(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 20vw\"\n                    priority={isPriority}\n                    loading={isPriority ? undefined : 'lazy'}\n                    unoptimized\n                  />\n\n                  {/* オーバーレイ */}\n                  <div className=\"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all duration-300 flex items-end\">\n                    <div className=\"p-3 w-full opacity-0 group-hover:opacity-100 transition-opacity duration-300\">\n                      <p className=\"text-xs truncate font-medium\">{image.name}</p>\n                      <p className=\"text-xs text-gray-400 mt-1\">\n                        {new Date(image.created_at).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                </Link>\n              );\n            })}\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;;;AANA;;;;;;AASA,mBAAmB;AACnB,SAAS;IACP,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;;;;;;;;;;AAGrB;KANS;AAQM,SAAS;;IACtB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAkB,EAAE;IACxD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB;IAElD,IAAA,0KAAS;gCAAC;YACR,eAAe;gBACb,IAAI;oBACF,MAAM,OAAO,MAAM,IAAA,iIAAW;oBAC9B,MAAM,iBAAiB,KAAK,GAAG;0EAAC,CAAA,MAAO,CAAC;gCACtC,GAAG,GAAG;gCACN,QAAQ,IAAA,iIAAc,EAAC,IAAI,IAAI;4BACjC,CAAC;;oBAED,WAAW;oBACX,eAAe,IAAI;2DAAC,CAAC,GAAG,IACtB,IAAI,KAAK,EAAE,UAAU,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,UAAU,EAAE,OAAO;;oBAGnE,qBAAqB;oBACrB,IAAI,eAAe,MAAM,GAAG,GAAG;wBAC7B,QAAQ,GAAG,CAAC,oBAAoB,cAAc,CAAC,EAAE,CAAC,GAAG;wBACrD,QAAQ,GAAG,CAAC,iBAAiB,eAAe,MAAM;oBACpD;oBAEA,UAAU;oBACV,WAAW;gBACb,EAAE,OAAO,KAAK;oBACZ,QAAQ,KAAK,CAAC,yBAAyB;oBACvC,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;oBAC9C,WAAW;gBACb;YACF;YAEA;QACF;+BAAG,EAAE;IAEL,IAAI,SAAS;QACX,qBACE,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAO,WAAU;8BAChB,cAAA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;;kDACC,6LAAC;wCAAG,WAAU;kDAAqB;;;;;;kDACnC,6LAAC;wCAAE,WAAU;kDAAwB;;;;;;;;;;;;0CAEvC,6LAAC,0KAAI;gCACH,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;;;;;;8BAKL,6LAAC;oBAAK,WAAU;8BACd,cAAA,6LAAC;wBAAI,WAAU;kCACZ,MAAM,IAAI,CAAC;4BAAE,QAAQ;wBAAG,GAAG,GAAG,CAAC,CAAC,GAAG,kBAClC,6LAAC,mBAAmB;;;;;;;;;;;;;;;;;;;;;IAMhC;IAEA,IAAI,OAAO;QACT,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;kCAAE;;;;;;kCACH,6LAAC;wBAAE,WAAU;kCAAgB;;;;;;kCAC7B,6LAAC,0KAAI;wBAAC,MAAK;wBAAI,WAAU;kCAAsD;;;;;;;;;;;;;;;;;IAMvF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAO,WAAU;0BAChB,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;;8CACC,6LAAC;oCAAG,WAAU;8CAAqB;;;;;;8CACnC,6LAAC;oCAAE,WAAU;;wCAAyB,OAAO,MAAM;wCAAC;;;;;;;;;;;;;sCAEtD,6LAAC,0KAAI;4BACH,MAAK;4BACL,WAAU;sCACX;;;;;;;;;;;;;;;;;0BAOL,6LAAC;gBAAK,WAAU;0BACb,OAAO,MAAM,KAAK,kBACjB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAE,WAAU;sCAAU;;;;;;sCACvB,6LAAC;4BAAE,WAAU;sCAAO;;;;;;;;;;;yCAGtB,6LAAC;oBAAI,WAAU;8BACZ,OAAO,GAAG,CAAC,CAAC,OAAO;wBAClB,gBAAgB;wBAChB,MAAM,aAAa,QAAQ;wBAC3B,uBAAuB;wBACvB,MAAM,eAAe,IAAA,kIAAe,EAAC,MAAM,GAAG,EAAE,KAAK;wBAErD,qBACE,6LAAC,0KAAI;4BAEH,MAAM,CAAC,QAAQ,EAAE,MAAM,MAAM,EAAE;4BAC/B,WAAU;;8CAEV,6LAAC,2IAAK;oCACJ,KAAK;oCACL,KAAK,MAAM,IAAI;oCACf,IAAI;oCACJ,WAAU;oCACV,OAAM;oCACN,UAAU;oCACV,SAAS,aAAa,YAAY;oCAClC,WAAW;;;;;;8CAIb,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC;wCAAI,WAAU;;0DACb,6LAAC;gDAAE,WAAU;0DAAgC,MAAM,IAAI;;;;;;0DACvD,6LAAC;gDAAE,WAAU;0DACV,IAAI,KAAK,MAAM,UAAU,EAAE,kBAAkB;;;;;;;;;;;;;;;;;;2BApB/C,MAAM,MAAM;;;;;oBA0BvB;;;;;;;;;;;;;;;;;AAMZ;GAlJwB;MAAA","debugId":null}}]
}