{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/4geru/space/spresense/spresense-slideshow/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport Image from 'next/image';\nimport Link from 'next/link';\n\ninterface ImageData {\n  name: string;\n  url: string;\n  created_at: string;\n  size: number;\n}\n\nexport default function SlideshowPage() {\n  const [images, setImages] = useState<ImageData[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [notification, setNotification] = useState<string | null>(null);\n  const [lastImageCount, setLastImageCount] = useState(0);\n  const [currentTime, setCurrentTime] = useState('');\n\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  // ÁîªÂÉè„ÇíË™≠„ÅøËæº„ÇÄ\n  const loadImages = useCallback(async () => {\n    try {\n      if (!supabaseUrl || !supabaseKey) {\n        throw new Error('Supabase configuration missing');\n      }\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/get-original-images`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${supabaseKey}`,\n          'apikey': supabaseKey,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);\n      }\n\n      const result = await response.json();\n\n      if (result.success && result.images) {\n        const imageList = result.images.map((image: any) => ({\n          name: image.name,\n          url: image.url,\n          created_at: image.created_at,\n          size: image.size\n        }));\n\n        setImages(imageList);\n        setLastImageCount(imageList.length);\n\n        if (imageList.length > 0) {\n          setCurrentIndex(Math.floor(Math.random() * imageList.length));\n          setLoading(false);\n        } else {\n          throw new Error('No images found with \"original_capture\" in filename');\n        }\n      } else {\n        throw new Error(result.error || 'No images returned from Edge Function');\n      }\n    } catch (err) {\n      console.error('Error loading images:', err);\n      setError(err instanceof Error ? err.message : 'Failed to load images');\n      setLoading(false);\n    }\n  }, [supabaseUrl, supabaseKey]);\n\n  // Êñ∞„Åó„ÅÑÁîªÂÉè„Çí„ÉÅ„Çß„ÉÉ„ÇØ\n  const checkForNewImages = useCallback(async () => {\n    try {\n      if (!supabaseUrl || !supabaseKey) return;\n\n      const response = await fetch(`${supabaseUrl}/functions/v1/get-original-images`, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${supabaseKey}`,\n          'apikey': supabaseKey,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (!response.ok) return;\n\n      const result = await response.json();\n\n      if (result.success && result.images) {\n        const newImageCount = result.images.length;\n\n        if (newImageCount > lastImageCount) {\n          console.log(`üÜï New images detected! ${lastImageCount} ‚Üí ${newImageCount}`);\n\n          const imageList = result.images.map((image: any) => ({\n            name: image.name,\n            url: image.url,\n            created_at: image.created_at,\n            size: image.size\n          }));\n\n          setImages(imageList);\n          setLastImageCount(newImageCount);\n          setCurrentIndex(Math.floor(Math.random() * imageList.length));\n\n          setNotification(`üÜï ${newImageCount - lastImageCount} new image${newImageCount - lastImageCount > 1 ? 's' : ''} detected!`);\n          setTimeout(() => setNotification(null), 3000);\n        }\n      }\n    } catch (err) {\n      console.error('Error checking for new images:', err);\n    }\n  }, [supabaseUrl, supabaseKey, lastImageCount]);\n\n  // Ê¨°„ÅÆÁîªÂÉè„Å´ÁßªÂãï\n  const nextImage = useCallback(() => {\n    if (images.length === 0) return;\n\n    let nextIndex;\n    if (images.length > 1) {\n      do {\n        nextIndex = Math.floor(Math.random() * images.length);\n      } while (nextIndex === currentIndex);\n    } else {\n      nextIndex = 0;\n    }\n\n    setCurrentIndex(nextIndex);\n  }, [images.length, currentIndex]);\n\n  // ÂàùÊúüË™≠„ÅøËæº„Åø\n  useEffect(() => {\n    loadImages();\n  }, [loadImages]);\n\n  // „Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº\n  useEffect(() => {\n    if (images.length <= 1) return;\n\n    const getRandomInterval = () => Math.floor(Math.random() * 1000) + 2000; // 2-3Áßí\n\n    const scheduleNext = () => {\n      const interval = getRandomInterval();\n      const timer = setTimeout(() => {\n        nextImage();\n      }, interval);\n      return timer;\n    };\n\n    const timer = scheduleNext();\n    return () => clearTimeout(timer);\n  }, [images.length, nextImage, currentIndex]);\n\n  // Ëá™Âãï„É™„Éï„É¨„ÉÉ„Ç∑„É•Ôºà30Áßí„Åî„Å®Ôºâ\n  useEffect(() => {\n    const interval = setInterval(() => {\n      checkForNewImages();\n    }, 30000);\n\n    return () => clearInterval(interval);\n  }, [checkForNewImages]);\n\n  // ÊôÇÂàªÊõ¥Êñ∞\n  useEffect(() => {\n    const updateTime = () => {\n      setCurrentTime(new Date().toLocaleTimeString());\n    };\n\n    updateTime();\n    const interval = setInterval(updateTime, 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  if (loading) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-black\">\n        <div className=\"text-white text-2xl\">Loading images...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center bg-black\">\n        <div className=\"text-red-400 text-xl text-center\">\n          <p>Failed to load images from Supabase</p>\n          <p className=\"mt-2\">Please check your connection and configuration</p>\n          <p className=\"mt-4 text-sm\">{error}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative w-screen h-screen bg-black overflow-hidden\">\n      {/* ÈÄöÁü• */}\n      {notification && (\n        <div className=\"fixed top-5 right-5 bg-green-500 bg-opacity-90 text-white px-5 py-4 rounded-lg text-base z-[2000] shadow-lg animate-slide-in\">\n          {notification}\n        </div>\n      )}\n\n      {/* „Çπ„ÉÜ„Éº„Çø„Çπ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */}\n      <div className=\"fixed top-5 left-5 bg-black bg-opacity-70 text-white px-4 py-2 rounded-md text-sm z-[2000]\">\n        üì∏ Images: {images.length} | üïí {currentTime}\n      </div>\n\n      {/* ÁîªÂÉè‰∏ÄË¶ß„Å∏„ÅÆ„É™„É≥„ÇØ */}\n      <Link\n        href=\"/slides\"\n        className=\"fixed top-5 left-1/2 -translate-x-1/2 bg-purple-600 bg-opacity-90 hover:bg-opacity-100 text-white px-6 py-2 rounded-lg text-sm z-[2000] transition shadow-lg\"\n      >\n        üì∑ View Gallery\n      </Link>\n\n      {/* „Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº */}\n      {images.length > 0 && (\n        <div className=\"w-full h-full flex items-center justify-center\">\n          <div className=\"relative w-full h-full\">\n            <Image\n              src={images[currentIndex].url}\n              alt={images[currentIndex].name}\n              fill\n              className=\"object-contain\"\n              priority\n              unoptimized // Supabase„ÅÆÁîªÂÉè„Å™„ÅÆ„ÅßÊúÄÈÅ©Âåñ„Çí„Çπ„Ç≠„ÉÉ„Éó\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}