{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/4geru/space/spresense/spresense-slideshow/contexts/LiffContext.tsx"],"sourcesContent":["'use client';\n\nimport { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport liff from '@line/liff';\n\nexport interface LiffProfile {\n  userId: string;\n  displayName: string;\n  pictureUrl?: string;\n  statusMessage?: string;\n}\n\ninterface LiffContextType {\n  isLoggedIn: boolean;\n  profile: LiffProfile | null;\n  isLiffReady: boolean;\n  error: string | null;\n  login: () => void;\n  logout: () => void;\n  sendMessage: (message: string) => Promise<void>;\n  closeWindow: () => void;\n  shareTargetPicker: (messages: any[]) => Promise<any>;\n  isInClient: boolean;\n}\n\nconst LiffContext = createContext<LiffContextType | undefined>(undefined);\n\nexport function LiffProvider({ children }: { children: ReactNode }) {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [profile, setProfile] = useState<LiffProfile | null>(null);\n  const [isLiffReady, setIsLiffReady] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    let timeoutId: NodeJS.Timeout | null = null;\n\n    const initLiff = async () => {\n      try {\n        console.log('üöÄ LIFF initialization started');\n        const liffId = process.env.NEXT_PUBLIC_LIFF_ID;\n        console.log('üìù LIFF ID:', liffId ? 'Found' : 'Not found');\n\n        if (!liffId) {\n          console.error('‚ùå LIFF ID is not configured');\n          setError('LIFF ID is not configured');\n          setIsLiffReady(true);\n          if (timeoutId) clearTimeout(timeoutId);\n          return;\n        }\n\n        // „Åô„Åß„Å´ÂàùÊúüÂåñÊ∏à„Åø„Åã„ÉÅ„Çß„ÉÉ„ÇØ\n        console.log('üîç Checking if LIFF is already initialized...');\n        try {\n          const isLoggedInStatus = liff.isLoggedIn();\n          console.log('‚úÖ LIFF already initialized, logged in:', isLoggedInStatus);\n\n          if (isLoggedInStatus) {\n            setIsLiffReady(true);\n            setIsLoggedIn(true);\n            if (timeoutId) clearTimeout(timeoutId);\n\n            try {\n              console.log('üë§ Fetching user profile...');\n              const userProfile = await liff.getProfile();\n              console.log('‚úÖ Profile fetched:', userProfile.displayName);\n              setProfile({\n                userId: userProfile.userId,\n                displayName: userProfile.displayName,\n                pictureUrl: userProfile.pictureUrl,\n                statusMessage: userProfile.statusMessage,\n              });\n            } catch (profileErr) {\n              console.error('‚ùå Profile fetch failed:', profileErr);\n            }\n            return;\n          } else {\n            console.log('‚ÑπÔ∏è LIFF initialized but not logged in');\n            setIsLiffReady(true);\n            if (timeoutId) clearTimeout(timeoutId);\n            return;\n          }\n        } catch (checkErr) {\n          console.log('‚ÑπÔ∏è LIFF not yet initialized, proceeding with init...');\n        }\n\n        // ÂàùÂõûÂàùÊúüÂåñ\n        console.log('üîß Starting LIFF init...');\n        await liff.init({ liffId });\n        console.log('‚úÖ LIFF init completed');\n        setIsLiffReady(true);\n        if (timeoutId) clearTimeout(timeoutId);\n\n        const isLoggedInStatus = liff.isLoggedIn();\n        console.log('üîê Login status after init:', isLoggedInStatus);\n\n        if (isLoggedInStatus) {\n          setIsLoggedIn(true);\n\n          console.log('üë§ Fetching user profile...');\n          const userProfile = await liff.getProfile();\n          console.log('‚úÖ Profile fetched:', userProfile.displayName);\n          setProfile({\n            userId: userProfile.userId,\n            displayName: userProfile.displayName,\n            pictureUrl: userProfile.pictureUrl,\n            statusMessage: userProfile.statusMessage,\n          });\n        }\n      } catch (err) {\n        console.error('‚ùå LIFF initialization failed:', err);\n        const errorMessage = err instanceof Error ? err.message : 'LIFF initialization failed';\n        console.error('Error details:', errorMessage);\n        setError(errorMessage);\n        setIsLiffReady(true);\n        if (timeoutId) clearTimeout(timeoutId);\n      }\n    };\n\n    // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàÂá¶ÁêÜ: 30ÁßíÁµå„Å£„Å¶„ÇÇÂàùÊúüÂåñ„ÅåÂÆå‰∫Ü„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ„Ç®„É©„Éº\n    timeoutId = setTimeout(() => {\n      console.error('‚è∞ LIFF initialization timeout (30 seconds)');\n      setError('LIFF initialization timeout. Please reload the page.');\n      setIsLiffReady(true);\n    }, 30000);\n\n    initLiff();\n\n    return () => {\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    };\n  }, []);\n\n  const login = () => {\n    if (!isLiffReady) {\n      console.warn('LIFF is not ready yet');\n      return;\n    }\n    liff.login();\n  };\n\n  const logout = () => {\n    if (!isLiffReady) {\n      console.warn('LIFF is not ready yet');\n      return;\n    }\n    liff.logout();\n    setIsLoggedIn(false);\n    setProfile(null);\n  };\n\n  const sendMessage = async (message: string) => {\n    if (!isLiffReady) {\n      throw new Error('LIFF is not ready');\n    }\n\n    if (!liff.isInClient()) {\n      throw new Error('This feature is only available in LINE app');\n    }\n\n    await liff.sendMessages([\n      {\n        type: 'text',\n        text: message,\n      },\n    ]);\n  };\n\n  const closeWindow = () => {\n    if (!isLiffReady) {\n      console.warn('LIFF is not ready yet');\n      return;\n    }\n    liff.closeWindow();\n  };\n\n  const shareTargetPicker = async (messages: any[]) => {\n    if (!isLiffReady) {\n      throw new Error('LIFF is not ready');\n    }\n\n    // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÂá∫Âäõ\n    console.log('LIFF Debug Info:', {\n      isInClient: liff.isInClient(),\n      isLoggedIn: liff.isLoggedIn(),\n      os: liff.getOS(),\n      language: liff.getLanguage(),\n      version: liff.getVersion(),\n      lineVersion: liff.getLineVersion(),\n      isApiAvailable: liff.isApiAvailable('shareTargetPicker'),\n    });\n\n    if (!liff.isInClient()) {\n      throw new Error('ShareTargetPicker is only available in LINE app. Please open this page in LINE app.');\n    }\n\n    if (!liff.isApiAvailable('shareTargetPicker')) {\n      throw new Error('ShareTargetPicker is not available. Please check LIFF app settings (Scope: chat_message.write required).');\n    }\n\n    try {\n      const result = await liff.shareTargetPicker(messages);\n      return result;\n    } catch (err) {\n      console.error('ShareTargetPicker error:', err);\n      throw err;\n    }\n  };\n\n  const value: LiffContextType = {\n    isLoggedIn,\n    profile,\n    isLiffReady,\n    error,\n    login,\n    logout,\n    sendMessage,\n    closeWindow,\n    shareTargetPicker,\n    isInClient: isLiffReady ? liff.isInClient() : false,\n  };\n\n  return <LiffContext.Provider value={value}>{children}</LiffContext.Provider>;\n}\n\nexport function useLiff() {\n  const context = useContext(LiffContext);\n  if (context === undefined) {\n    throw new Error('useLiff must be used within a LiffProvider');\n  }\n  return context;\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}